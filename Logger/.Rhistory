all_loggers <- bind_rows(lapply(logger_names, get))
str(all_loggers)
# Zeitspalte korrekt formatieren
all_loggers <- all_loggers %>%
mutate(DateTime = as.POSIXct(DateTime, format="%Y-%m-%d %H:%M:%S")) %>%
filter(DateTime >= as.POSIXct("2025-05-08 00:00:00") &
DateTime <= as.POSIXct("2025-09-30 23:59:59"))
# Alle Logger und Standorte explizit bestimmen
logger_list <- all_loggers %>%
distinct(Standort, Logger, Logger_ID)
# Zeitreihe erstellen: alle 10 Minuten vom 08.05 bis 30.09.2025
zeitpunkte <- tibble(DateTime = seq(
from = as.POSIXct("2025-05-08 00:00:00"),
to   = as.POSIXct("2025-09-30 23:50:00"),
by   = "10 min"
))
attr(all_loggers$DateTime, "tzone")
attr(zeitpunkte, "tzone")
#library(tidyverse)
library(dplyr)
library(lubridate)
library(tidyr)
library(ggplot2)
#Lichtenau
LM_lt <- read.csv("Licht-und-Temperatur-aussen/Lichtenau Mitte 2025-11-04 18_39_12 CET.csv")
LO_lt <- read.csv("Licht-und-Temperatur-aussen/Lichtenau Ost 2025-10-02 14_50_43 CEST.csv")
LW_lt <- read.csv("Licht-und-Temperatur-aussen/Lichtenau West 2025-11-04 18_36_30 CET.csv")
LN_lt <- read.csv("Licht-und-Temperatur-aussen/Lichtenau Nord 2025-10-02 14_52_52 CEST.csv")
LS_lt <- read.csv("Licht-und-Temperatur-aussen/Lichtenau Süd 2025-10-02 14_51_42 CEST.csv")
#Meusebach trocken
MTM_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach trock Mitt 2025-11-04 10_33_23 CET.csv")
MTO_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach trock Ost 2025-11-04 10_42_29 CET.csv")
MTW_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach trock West 2025-10-02 14_56_44 CEST.csv")
MTN_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach trock Nord 2025-11-04 10_34_51 CET.csv")
MTS_lt<- read.csv("Licht-und-Temperatur-aussen/Meusebach trock Süd 2025-10-02 14_54_52 CEST.csv")
#Meusebach nass
MNM_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach nass Mitte 2025-11-04 11_37_40 CET.csv")
MNO_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach nass Ost  2025-10-02 14_55_48 CEST.csv")
MNW_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach nass West 2025-11-04 11_33_52 CET.csv")
MNN_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach nass Nord 2025-10-02 14_53_40 CEST.csv")
MNS_lt <- read.csv("Licht-und-Temperatur-aussen/Meusebach nass Süd 2025-11-04 11_35_49 CET.csv")
#Lichtenau
LM_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Lichtenau Mitte  2025-11-04 14_05_01 CET.csv")
LO_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Lichtenau Ost 2025-10-02 14_47_35 CEST.csv")
LW_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Lichtenau West 2025-11-04 14_05_41 CET.csv")
LN_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Lichtenau Nord 2025-10-02 14_47_08 CEST.csv")
LS_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Lichtenau Süd 2025-10-02 14_46_44 CEST.csv")
#Meusebach trocken
MTM_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach trock Mitt 2025-11-04 10_30_53 CET.csv")
MTO_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach trock Ost 2025-11-04 10_31_49 CET.csv")
MTW_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach trock West 2025-10-02 14_45_08 CEST.csv")
MTN_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach trock Nord 2025-11-04 10_32_27 CET.csv")
MTS_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach trock Süd 2025-10-02 14_43_36 CEST.csv")
#Meusebach nass
MNM_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach nass Mitte 2025-11-04 11_36_57 CET.csv")
MNO_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach nass Ost 2025-10-02 14_45_34 CEST.csv")
MNW_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach nass West 2025-11-04 11_33_09 CET.csv")
MNN_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach nass Nord 2025-10-02 14_45_57 CEST.csv")
MNS_th <- read.csv("Luftfeuchte-und-Temperatur-innen/Meusebach nass Süd 2025-11-04 11_35_14 CET.csv")
#| label: long date conversion
#Datumsformat umwandeln
LM_lt$DateTime <- mdy_hms(LM_lt$Date.Time..CEST.CET.)
LM_th$DateTime <- mdy_hms(LM_th$Date.Time..CEST.CET.)
LO_lt$DateTime <- mdy_hms(LO_lt$Date.Time..CEST.)
LO_th$DateTime <- mdy_hms(LO_th$Date.Time..CEST.)
LW_lt$DateTime <- mdy_hms(LW_lt$Date.Time..CEST.CET.)
LW_th$DateTime <- mdy_hms(LW_th$Date.Time..CEST.CET.)
LN_lt$DateTime <- mdy_hms(LN_lt$Date.Time..CEST.)
LN_th$DateTime <- mdy_hms(LN_th$Date.Time..CEST.)
LS_lt$DateTime <- mdy_hms(LS_lt$Date.Time..CEST.)
LS_th$DateTime <- mdy_hms(LS_th$Date.Time..CEST.)
MTM_lt$DateTime <- mdy_hms(MTM_lt$Date.Time..CEST.CET.)
MTM_th$DateTime <- mdy_hms(MTM_th$Date.Time..CEST.CET.)
MTO_lt$DateTime <- mdy_hms(MTO_lt$Date.Time..CEST.CET.)
MTO_th$DateTime <- mdy_hms(MTO_th$Date.Time..CEST.CET.)
MTW_lt$DateTime <- mdy_hms(MTW_lt$Date.Time..CEST.)
MTW_th$DateTime <- mdy_hms(MTW_th$Date.Time..CEST.)
MTN_lt$DateTime <- mdy_hms(MTN_lt$Date.Time..CEST.CET.)
MTN_th$DateTime <- mdy_hms(MTN_th$Date.Time..CEST.CET.)
MTS_lt$DateTime <- mdy_hms(MTS_lt$Date.Time..CEST.)
MTS_th$DateTime <- mdy_hms(MTS_th$Date.Time..CEST.)
MNM_lt$DateTime <- mdy_hms(MNM_lt$Date.Time..CEST.CET.)
MNM_th$DateTime <- mdy_hms(MNM_th$Date.Time..CEST.CET.)
MNO_lt$DateTime <- mdy_hms(MNO_lt$Date.Time..CEST.)
MNO_th$DateTime <- mdy_hms(MNO_th$Date.Time..CEST.)
MNW_lt$DateTime <- mdy_hms(MNW_lt$Date.Time..CEST.)
MNW_th$DateTime <- mdy_hms(MNW_th$Date.Time..CEST.)
MNN_lt$DateTime <- mdy_hms(MNN_lt$Date.Time..CEST.)
MNN_th$DateTime <- mdy_hms(MNN_th$Date.Time..CEST.)
MNS_lt$DateTime <- mdy_hms(MNS_lt$Date.Time..CEST.CET.)
MNS_th$DateTime <- mdy_hms(MNS_th$Date.Time..CEST.CET.)
#| label: alternative date conversion
logger_names <- ls(pattern = "_lt$|_th$")
for (obj in logger_names)
df <- get(obj)
date_col <- names(df)[grepl("^Date.Time", names(df))]
df$DateTime <- mdy_hms(df[[date_col]], tz = "Europe/Berlin")
assign(obj, df)
# Tabellen beider Logger pro Standort zusammenführen
#einige Variablen in den Originaltabellen brauchen wir nicht mehr, daher bauen wir eine cleane Tabelle, die nur analyserelevante Daten beinhaltet
LM_lt_clean <- LM_lt %>%
select(
DateTime,
Temp_sonne = Temperature.....C.,
Licht_lux  = Light....lux.
)
LM_th_clean <- LM_th %>%
select(
DateTime,
Temp_schatten = Temperature.....C.,
relLF         = RH......,
Taupunkt      = Dew.Point.....C.
)
# Zusammenführen der beiden Tabellen vom gleichen Standort mit join
LM <- full_join(LM_lt_clean,LM_th_clean,by = "DateTime")
# Einfügen einer Loggerkennung, Standortkennnung und Logger ID
LM <- LM %>%
mutate(
Standort = "L",
Logger   = "M",
Logger_ID = "LM"
)
summary(LM)
str(LM)
#zum Zusammenführen der Tabellen wurde die folgende Fuktion erstellt
join_loggers <- function(df_lt, df_th, standort, logger) {
# cleane Tabellen erstellen, weil in Originaltabellen einiges irrelevantes drin
lt_clean <- df_lt %>%
select(
DateTime,
Temp_sonne_C = Temperature.....C.,
Licht_lux  = Light....lux.
)
th_clean <- df_th %>%
select(
DateTime,
Temp_schatten_C = Temperature.....C.,
relLF_percent         = RH......,
Taupunkt_C      = Dew.Point.....C.
)
# join
full_join(lt_clean, th_clean, by = "DateTime") %>%
mutate(
Standort  = standort,
Logger    = logger,
Logger_ID = paste0(standort, logger)
)
}
#Lichtenau Mitte
LM <- join_loggers(
df_lt    = LM_lt,
df_th    = LM_th,
standort = "L",
logger   = "M"
)
#Lichtenau Ost
LO <- join_loggers(
df_lt    = LO_lt,
df_th    = LO_th,
standort = "L",
logger   = "O"
)
#Lichtenau West
LW <- join_loggers(
df_lt    = LW_lt,
df_th    = LW_th,
standort = "L",
logger   = "W"
)
#Lichtenau Nord
LN <- join_loggers(
df_lt    = LN_lt,
df_th    = LN_th,
standort = "L",
logger   = "N"
)
#Lichtenau Süd
LS <- join_loggers(
df_lt    = LS_lt,
df_th    = LS_th,
standort = "L",
logger   = "S"
)
#Meusebach trocken Mitte
MTM <- join_loggers(
df_lt    = MTM_lt,
df_th    = MTM_th,
standort = "MT",
logger   = "M"
)
#Meusebach trocken Ost
MTO <- join_loggers(
df_lt    = MTO_lt,
df_th    = MTO_th,
standort = "MT",
logger   = "O"
)
#Meusebach trocken West
MTW <- join_loggers(
df_lt    = MTW_lt,
df_th    = MTW_th,
standort = "MT",
logger   = "W"
)
#Meusebach trocken Nord
MTN <- join_loggers(
df_lt    = MTN_lt,
df_th    = MTN_th,
standort = "MT",
logger   = "N"
)
#Meusebach trocken Süd
MTS <- join_loggers(
df_lt    = MTS_lt,
df_th    = MTS_th,
standort = "MT",
logger   = "S"
)
#Meusebach nass Mitte
MNM <- join_loggers(
df_lt    = MNM_lt,
df_th    = MNM_th,
standort = "MN",
logger   = "M"
)
#Meusebach nass Ost
MNO <- join_loggers(
df_lt    = MNO_lt,
df_th    = MNO_th,
standort = "MN",
logger   = "O"
)
#Meusebach nass West
MNW <- join_loggers(
df_lt    = MNW_lt,
df_th    = MNW_th,
standort = "MN",
logger   = "W"
)
#Meusebach nass Nord
MNN <- join_loggers(
df_lt    = MNN_lt,
df_th    = MNN_th,
standort = "MN",
logger   = "N"
)
#Meusebach nass Süd
MNS <- join_loggers(
df_lt    = MNS_lt,
df_th    = MNS_th,
standort = "MN",
logger   = "S"
)
# alle Daten vor dem 08.05.2025 00:00 Uhr entfernen
# alle Daten nach dem 30.9.2025 23:50 Uhr entfernen
cutoff_start <- as.POSIXct("2025-05-08 00:00:00", tz="UTC")
cutoff_end   <- as.POSIXct("2025-09-30 23:50:00", tz="UTC")
logger_names <- c("LM", "LO", "LW", "LN", "LS", "MTM", "MTO", "MTW", "MTN", "MTS", "MNM", "MNO", "MNW", "MNN", "MNS")
for (logger in logger_names) {
assign(logger, get(logger) %>%
filter(DateTime >= cutoff_start & DateTime <= cutoff_end))
}
#entfernen von Zeilen ohne Messwerte (entstanden durch Auslesen der Logger)
#messwert_spalten <- c("Temp_sonne_C", "Licht_lux", "Temp_schatten_C", "relLF_percent", "Taupunkt_C")
#for (logger in logger_names) {
# Tabelle holen, filtern, wieder zurückschreiben
#assign(logger, get(logger) %>%
#filter(!if_all(all_of(messwert_spalten), is.na)))
#}
#Zusammenführen als Masterdatensatz
all_loggers <- bind_rows(lapply(logger_names, get))
str(all_loggers)
# Zeitspalte korrekt formatieren
all_loggers <- all_loggers %>%
mutate(DateTime = as.POSIXct(DateTime, format="%Y-%m-%d %H:%M:%S")) %>%
filter(DateTime >= as.POSIXct("2025-05-08 00:00:00") &
DateTime <= as.POSIXct("2025-09-30 23:59:59"))
# Alle Logger und Standorte explizit bestimmen
logger_list <- all_loggers %>%
distinct(Standort, Logger, Logger_ID)
# Zeitreihe erstellen: alle 10 Minuten vom 08.05 bis 30.09.2025
zeitpunkte <- seq(
from = as.POSIXct("2025-05-08 00:00:00", tz = "UTC"),
to   = as.POSIXct("2025-09-30 23:50:00", tz = "UTC"),
by   = "10 min"
)
attr(all_loggers$DateTime, "tzone")
attr(zeitpunkte, "tzone")
# Kreuzprodukt
voller_raster <- tidyr::crossing(logger_list, zeitpunkte)
# Originaldaten einfügen
all_loggers_complete <- voller_raster %>%
left_join(all_loggers, by = c("Standort", "Logger", "Logger_ID", "DateTime")) %>%
# Filter auf gewünschten Zeitraum (sicherstellen)
filter(DateTime >= as.POSIXct("2025-05-08 00:00:00") &
DateTime <= as.POSIXct("2025-09-30 23:50:00"))
# Originaldaten einfügen
all_loggers_complete <- voller_raster %>%
left_join(all_loggers, by = c("Standort", "Logger", "Logger_ID", "DateTime")) %>%
# Filter auf gewünschten Zeitraum (sicherstellen)
filter(DateTime >= as.POSIXct("2025-05-08 00:00:00") &
DateTime <= as.POSIXct("2025-09-30 23:50:00"))
# Originaldaten einfügen
all_loggers_complete <- voller_raster %>%
left_join(all_loggers, by = c("Standort", "Logger", "Logger_ID", "DateTime")) %>%
# Fehlende Werte pro Zeile zählen (mindestens eine Messgröße fehlt)
fehlende_zeitpunkte <- all_loggers_complete %>%
mutate(Anzahl_NA = rowSums(is.na(select(., Temp_sonne_C, Licht_lux, Temp_schatten_C,
relLF_percent, Taupunkt_C)))) %>%
filter(Anzahl_NA > 0)  # Zeilen, bei denen mindestens eine Messgröße fehlt
# Originaldaten einfügen
all_loggers_complete <- voller_raster %>%
left_join(all_loggers, by = c("Standort", "Logger", "Logger_ID", "DateTime")) %>%
# Fehlende Werte pro Zeile zählen (mindestens eine Messgröße fehlt)
fehlende_zeitpunkte <- all_loggers_complete %>%
mutate(Anzahl_NA = rowSums(is.na(select(., Temp_sonne_C, Licht_lux, Temp_schatten_C,
relLF_percent, Taupunkt_C)))) %>%
filter(Anzahl_NA > 0)  # Zeilen, bei denen mindestens eine Messgröße fehlt
# Originaldaten einfügen
all_loggers_complete <- voller_raster %>% left_join(all_loggers, by = c("Standort", "Logger", "Logger_ID", "DateTime"))
colnames(voller_raster)
# Kreuzprodukt
voller_raster <- tidyr::crossing(logger_list, zeitpunkte)
voller_raster <- voller_raster %>%
rename(DateTime = zeitpunkte)
colnames(voller_raster)
# Originaldaten einfügen
all_loggers_complete <- voller_raster %>% left_join(all_loggers, by = c("Standort", "Logger", "Logger_ID", "DateTime"))
View(all_loggers_complete)
# Fehlende Werte pro Zeile zählen (mindestens eine Messgröße fehlt)
fehlende_zeitpunkte <- all_loggers_complete %>%
mutate(Anzahl_NA = rowSums(is.na(select(., Temp_sonne_C, Licht_lux, Temp_schatten_C,
relLF_percent, Taupunkt_C)))) %>%
filter(Anzahl_NA > 0)  # Zeilen, bei denen mindestens eine Messgröße fehlt
# Zusammenfassung pro Logger und Standort
fehlende_werte_summary <- fehlende_zeitpunkte %>%
group_by(Standort, Logger, Logger_ID) %>%
summarise(
Temp_sonne_C_missing    = sum(is.na(Temp_sonne_C)),
Licht_lux_missing       = sum(is.na(Licht_lux)),
Temp_schatten_C_missing = sum(is.na(Temp_schatten_C)),
relLF_percent_missing   = sum(is.na(relLF_percent)),
Taupunkt_C_missing      = sum(is.na(Taupunkt_C)),
Gesamt_fehlend          = n(),   # alle Zeilen mit mindestens einem fehlenden Wert
.groups = "drop"
) %>%
arrange(Standort, Logger, Logger_ID)
#install.packages("mice")
library(mice)
# Tabelle nur mit den Loggern von MT
MT_data_complete <- all_loggers_complete %>%
filter(Standort == "MT")
# Meta-Daten speichern
meta <- MT_data_complete %>%
select(DateTime, Logger, Logger_ID, Standort)
# Nur Messwerte auswählen (müssen numeric sein)
numeric_cols <- MT_data_complete %>%
select(-DateTime, -Logger, -Logger_ID, -Standort)
# Vor der Imputation Flag setzen
numeric_cols_flag <- numeric_cols %>%
mutate(across(everything(), ~is.na(.)))  # TRUE = fehlend
# Imputation mit mice durchführen
# method = "pmm" = predictive mean matching
imputed_data <- mice(numeric_cols, m = 1, method = "pmm", maxit = 5, seed = 123)
completed_data <- complete(imputed_data)
# Ergebnisse wieder zusammenfügen
MT_data_imputed <- cbind(meta, completed_data)
View(MT_data_imputed)
View(fehlende_werte_summary)
View(fehlende_zeitpunkte)
View(all_loggers)
View(all_loggers_complete)
View(all_loggers)
View(MT_data_complete)
plot(imputed_data)
# Tabelle nur mit den Loggern von MT
MT_data_complete <- all_loggers_complete %>%
filter(Standort == "MT")
# Meta-Daten speichern
meta <- MT_data_complete %>%
select(DateTime, Logger, Logger_ID, Standort)
# Nur Messwerte auswählen (müssen numeric sein)
numeric_cols <- MT_data_complete %>%
select(-DateTime, -Logger, -Logger_ID, -Standort)
# Vor der Imputation Flag setzen
numeric_cols_flag <- numeric_cols %>%
mutate(across(everything(), ~is.na(.)))  # TRUE = fehlend
# Imputation mit mice durchführen
# method = "pmm" = predictive mean matching
imputed_data <- mice(numeric_cols, m = 1, method = "pmm", maxit = 20, seed = 123)
completed_data <- complete(imputed_data)
# Ergebnisse wieder zusammenfügen
MT_data_imputed <- cbind(meta, completed_data)
plot(imputed_data)
imputed_data$predictorMatrix
Temp_sonne_wide <- MT_data_complete %>%
select(DateTime, Logger, Temp_sonne_C) %>%
pivot_wider(
names_from = Logger,
values_from = Temp_sonne_C,
names_prefix = "TempSonne_"
)
Licht_wide <- MT_data_complete %>%
select(DateTime, Logger, Licht_lux) %>%
pivot_wider(
names_from = Logger,
values_from = Licht_lux,
names_prefix = "Licht_"
)
Temp_schatten_wide <- MT_data_complete %>%
select(DateTime, Logger, Temp_schatten_C) %>%
pivot_wider(
names_from = Logger,
values_from = Temp_schatten_C,
names_prefix = "TempSchatten_"
)
Temp_schatten_wide <- MT_data_complete %>%
select(DateTime, Logger, Taupunkt_C) %>%
pivot_wider(
names_from = Logger,
values_from = Taupunkt_C,
names_prefix = "Taupunkt"
)
Temp_sonne_wide <- MT_data_complete %>%
select(DateTime, Logger, Temp_sonne_C) %>%
pivot_wider(
names_from = Logger,
values_from = Temp_sonne_C,
names_prefix = "TempSonne_"
)
Licht_wide <- MT_data_complete %>%
select(DateTime, Logger, Licht_lux) %>%
pivot_wider(
names_from = Logger,
values_from = Licht_lux,
names_prefix = "Licht_"
)
Temp_schatten_wide <- MT_data_complete %>%
select(DateTime, Logger, Temp_schatten_C) %>%
pivot_wider(
names_from = Logger,
values_from = Temp_schatten_C,
names_prefix = "TempSchatten_"
)
Taupunkt_wide <- MT_data_complete %>%
select(DateTime, Logger, Taupunkt_C) %>%
pivot_wider(
names_from = Logger,
values_from = Taupunkt_C,
names_prefix = "Taupunkt"
)
relLF_wide <- MT_data_complete %>%
select(DateTime, Logger, relLF_percent) %>%
pivot_wider(
names_from = Logger,
values_from = relLF_percent,
names_prefix = "relLF"
)
messgroessen <- c(
"Temp_sonne_C",
"Temp_schatten_C",
"Licht_lux",
"relLF_percent",
"Taupunkt_C"
)
MT_wide <- MT_data_complete %>%
select(DateTime, Logger, all_of(messgroessen)) %>%
pivot_wider(
names_from  = Logger,
values_from = all_of(messgroessen),
names_sep   = "_"
)
View(MT_wide)
meta <- MT_wide %>%
select(DateTime)
numeric_cols <- MT_wide %>%
select(-DateTime)
numeric_cols_flag <- numeric_cols %>%
mutate(across(everything(), ~is.na(.)))
imputed_data <- mice(
numeric_cols,
m = 1,        # eine imputierte Version
method = "pmm",
maxit = 5,    # 5 Iterationen
seed = 123
)
completed_data <- complete(imputed_data)
MT_imputed_wide <- cbind(meta, completed_data)
View(MT_imputed_wide)
plot(imputed_data)
imputed_data <- mice(
numeric_cols,
m = 1,        # eine imputierte Version
method = "pmm",
maxit = 20,    # 5 Iterationen
seed = 123
)
completed_data <- complete(imputed_data)
MT_imputed_wide <- cbind(meta, completed_data)
plot(imputed_data)
View(MT_imputed_wide)
imputed_data <- mice(
numeric_cols,
m = 1,        # eine imputierte Version
method = "pmm",
maxit = 50,    # 5 Iterationen
seed = 123
)
completed_data <- complete(imputed_data)
MT_imputed_wide <- cbind(meta, completed_data)
plot(imputed_data)
View(MT_imputed_wide)
