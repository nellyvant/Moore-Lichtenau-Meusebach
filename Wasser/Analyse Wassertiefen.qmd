---
title: "Analyse Wassertiefen"
format: html
editor: visual
---

# 1 Genutzte Packages

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
```

# 2 Daten einlesen

```{r}
Wassertiefen <- read_excel("Tabelle Wassertiefe.xlsx")
summary(Wassertiefen)
str(Wassertiefen)
class(Wassertiefen$Datum)

# Datum als Date konvertieren
Wassertiefen$Datum <- as.Date(Wassertiefen$Datum)
str(Wassertiefen)
class(Wassertiefen$Datum)
```

# 3 Auswertung

```{r}
# Mittelwerte pro Tag/ pro Standort berechnen 
WT_mittel <- Wassertiefen %>%
  group_by(Datum, Standort) %>% 
  summarise(WT_mean = mean(Wassertiefe, na.rm = TRUE)) %>%
  ungroup()

```

## 3.1 Jahresverlauf der Wassertiefe (MT vs MN vs L)

```{r}
# Liniendiagramm - Jahresverlauf
ggplot(WT_mittel, aes(x = Datum, y = WT_mean, color = Standort)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "Zeitlicher Verlauf der mittleren Wassertiefe nach Standort",
    x = "Datum",
    y = "Mittlere Wassertiefe (cm)",
    color = "Standort"
  ) +
  theme_minimal() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
```

## 3.2 Unterschiede zwischen den Standorten

```{r}
# Boxplot - Unterschiede zw. Standorten (Tagesmittelwerte)
ggplot(WT_mittel, aes(x = factor(Standort), y = WT_mean, fill = Standort)) +
  geom_boxplot() +
  labs(
    title = "Vergleich der mittleren Wassertiefe nach Standort",
    x = "Standort",
    y = "Mittlere Wassertiefe (cm)"
  ) +
  theme_minimal()

```

```{r}
# Boxplot pro Standort, Messpunkte farblich unterscheiden
ggplot(Wassertiefen, aes(x = factor(Standort), y = Wassertiefe, fill = factor(Messpunkt))) +
  geom_boxplot(position = position_dodge(0.8)) +
  labs(title = "Vergleich der Wassertiefen nach Standort und Messstelle (Mai–Sep 2025)",
       x = "Standort",
       y = "Wassertiefe (cm)",
       fill = "Messstelle") +
  theme_minimal()

```

## 3.3 Unterschiede innerhalb eines Standortes

```{r}
####Jahresverlauf - Liniendiagramm
plot_lin <- function(df, st, titel=NULL) {
  
  # Daten  nach Standort filtern
  df_sub1 <- df %>% filter(Standort == st)

  # Automatischer Titel
  if (is.null(titel)) {
    titel <- paste("Wassertiefeschwankungen -", st)
  }
  
  ggplot(df_sub1, aes(Datum, Wassertiefe, color = factor(Messpunkt))) +
    geom_line(linewidth = 1) +
    geom_point(size = 2) +
    labs(title = titel,
         x = "Datum", y = "Wassertiefe (cm)", color = "Messstelle") +
    theme_minimal() +
    # Achse automatisch an vorhandene Daten anpassen
    scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
}



#### Unterschiede zw. den Messstellen - Boxplot 
plot_box <- function(df, st, titel=NULL, x_name=NULL) {
  
  # Daten filtern
  df_sub2 <- df %>% filter(Standort == st)
  
  # Titel setzen, falls NULL
  if (is.null(titel)) {
    titel <- paste("Wassertiefeschwankungen nach Messpunkt -", st)
  }
  
  # x-Achsenname setzen, falls NULL
  if (is.null(x_name)) {
    x_name <- "Messpunkt"  # Standard
  }
  
  ggplot(df_sub2, aes(x = factor(Messpunkt), y = Wassertiefe, fill = factor(Messpunkt))) +
    geom_boxplot() +
    labs(
      title = titel,
      x = x_name,           # hier wird der flexible Name verwendet
      y = "Wassertiefe (cm)",
      fill = "Messstelle"
    ) +
    theme_minimal()
}

```

### Meusebach trocken

```{r}
# Liniendiagramm
plot_lin(Wassertiefen, "MT", titel="Wassertiefen in Meusebach trocken Mai–September 2025")
```

```{r}
# Boxplot
plot_box(Wassertiefen, st="MT",
         titel="Messpunkte Meusebach trocken: Mai–Sep 2025",
         x_name="Meusebach trocken")
```

### Meusebach nass

```{r}
# Liniendiagramm
plot_lin(Wassertiefen, "MN", titel="Wassertiefen in Meusebach nass Mai–September 2025")
```

```{r}
# Boxplot
plot_box(Wassertiefen, st="MN",
         titel="Messpunkte Meusebach nass: Mai–Sep 2025",
         x_name="Meusebach nass")
```

### Lichtenau

```{r}
# Liniendiagramm
plot_lin(Wassertiefen, "L", titel="Wassertiefen in Lichtenau: Mai–September 2025")
```

```{r}
# Boxplot
plot_box(Wassertiefen, st="L",
         titel="Messpunkte Lichtenau: Mai–Sep 2025",
         x_name="Meusebach nass")
```

## 3.4 Relevante Fragen, da die Diagramme ggf. ein falsches Bild vermitteln 

### Wasserstandsschwankungen 

```{r}
# welcher Standort hat die größten Wasserstandsschwankungen?

# Standardabweichung = wie stark der Wasserstand typischerweise um seinen Mittelwert schwankt
# Spannweite des Wasserstands = extremste Unterschiede zwischen dem höchsten und niedrigsten gemessenen Wasserstand

#Schwankung pro Standort (über Tagesmittelwerte)
WT_var_st <- WT_mittel %>%
  group_by(Standort) %>%
  summarise(
    sd_WT = sd(WT_mean, na.rm = TRUE),
    range_WT = max(WT_mean, na.rm = TRUE) - min(WT_mean, na.rm = TRUE)
  ) %>%
  arrange(desc(sd_WT))

WT_var_st

```

```{r}
# Schwankung pro Messpunkt innerhalb eines Standorts
WT_var_mp <- Wassertiefen %>%
  group_by(Standort, Messpunkt) %>%
  summarise(
    sd_WT = sd(Wassertiefe, na.rm = TRUE),
    range_WT = max(Wassertiefe, na.rm = TRUE) - min(Wassertiefe, na.rm = TRUE)
  ) %>%
  arrange(desc(sd_WT))

WT_var_mp
```

```{r}
# welcher Standort hat die meisten trocken gefallenen Tage, welcher die wenigsten (= Beständigkeit des Gewässers/Wasserspiegel)

```

```{r}
# auch daraus kann man ggf ableiten, welches Gewässer das Wasser besser hält und Faktoren ableiten, warum es bei den anderen nicht so ist -> naturschutzfachliche Maßnahmen ggf ableiten/überdenken 
```
